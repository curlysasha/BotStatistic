<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–æ–≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
<div class="container py-5">

    <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="card shadow-sm mb-4" data-aos="fade-down">
        <div class="card-body text-center">
            <h2>üìå –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–æ–≤</h2>
            <p>–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: <strong>{{ stats.total_files }}</strong></p>
            <p>–°—Ä–µ–¥–Ω–µ–µ –≤ –¥–µ–Ω—å: <strong>{{ stats.average_per_day }}</strong></p>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π -->
    <div class="card shadow-sm mb-4" data-aos="fade-up">
        <div class="card-body">
            <h3 class="text-center">üìÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</h3>
            <table class="table table-bordered text-center">
                <thead class="table-primary">
                <tr>
                    <th>–î–∞—Ç–∞ üìÜ</th>
                    <th>–§–∞–π–ª–æ–≤ üìÅ</th>
                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π üë•</th>
                </tr>
                </thead>
                <tbody>
                {% for date, files_count, users_count in stats.last_7_days %}
                    <tr>
                        <td>{{ date }}</td>
                        <td>{{ files_count }}</td>
                        <td>{{ users_count }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –Ω–µ–¥–µ–ª—é -->
    <div class="card shadow-sm mb-4" data-aos="fade-up">
        <div class="card-body">
            <h3 class="text-center">üåü –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –Ω–µ–¥–µ–ª—é</h3>
            <table class="table table-bordered text-center">
                <thead class="table-warning">
                <tr>
                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                    <th>–§–∞–π–ª–æ–≤</th>
                </tr>
                </thead>
                <tbody>
                {% for user, count in stats.top_users_week %}
                    <tr>
                        <td>{{ user }}</td>
                        <td>{{ count }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- –¢–æ–ø-5 –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π -->
    <div class="card shadow-sm mb-4" data-aos="fade-up">
        <div class="card-body">
            <h3 class="text-center">üî• –¢–æ–ø-5 –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π</h3>
            <ul class="list-group">
                {% for day, count in stats.top_days %}
                    <li class="list-group-item d-flex justify-content-between">
                        <span>{{ day }}</span><span>üìÅ {{ count }}</span>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫ -->
    <div class="card shadow-sm" data-aos="fade-up">
        <div class="card-body">
            <h3 class="text-center">üìà –î–∏–Ω–∞–º–∏–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</h3>
            <canvas id="weeklyChart"></canvas>
        </div>
    </div>

    <div class="text-center py-4">
        <a href="/export" class="btn btn-success btn-lg">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</a>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
AOS.init();

const ctx = document.getElementById('weeklyChart');
new Chart(ctx, {
    type: 'line',
    data: {
        labels: [{% for date, _, _ in stats.last_7_days %}'{{date}}',{% endfor %}],
        datasets: [
            {
                label: '–§–∞–π–ª–æ–≤ –∑–∞ –¥–µ–Ω—å',
                data: [{% for _, files, _ in stats.last_7_days %}{{files}},{% endfor %}],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59,130,246,0.2)',
                tension: 0.3,
                fill: true
            },
            {
                label: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –¥–µ–Ω—å',
                data: [{% for _, _, users in stats.last_7_days %}{{users}},{% endfor %}],
                borderColor: '#ef4444',
                backgroundColor: 'rgba(239,68,68,0.2)',
                tension: 0.3,
                fill: true
            }
        ]
    },
    options: {
        responsive: true,
        scales: {
            x: {
                ticks: {maxRotation:45,minRotation:45}
            },
            y: {
                beginAtZero: true
            }
        }
    }
});

// –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
setTimeout(() => location.reload(), 300000);
</script>
</body>
</html>

